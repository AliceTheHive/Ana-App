<h2 mat-dialog-title>Edit chat node information</h2>
<md-dialog-content>
    <md-tab-group>
        <md-tab label="Node Info">
            <div class="node-details tab-content">
                <div class="node-basic-info">
                    <md-form-field>
                        <input mdInput type="text" placeholder="Node Name" [(ngModel)]="chatNode.Name" name="nodeName">
                    </md-form-field>
                    <section>
                        <md-select placeholder="Node Type" [(ngModel)]="chatNode.NodeType" name="nodeType">
                            <md-option *ngFor="let nType of MH.nodeTypes" [value]="nType">
                                {{ nType }}
                            </md-option>
                        </md-select>
                    </section>
                    <section class="form-field">
                        <md-checkbox [(ngModel)]="chatNode.IsStartNode" (click)="MH.resetOtherStartNodes(chatNode)" name="isStartNode" align="start">Mark as start node</md-checkbox>
                    </section>
                    <md-form-field>
                        <input mdInput type="text" placeholder="Variable Name" [(ngModel)]="chatNode.VariableName" name="variableName">
                    </md-form-field>
                    <md-form-field>
                        <input mdInput type="text" disabled readonly placeholder="Node Id" [(ngModel)]="chatNode.Id" name="nodeId">
                    </md-form-field>
                </div>
                <div class="node-api-details" [hidden]="chatNode.NodeType!='ApiCall'">
                    <div class="panel panel-default">
                        <div class="panel-heading">API Details</div>
                        <div class="panel-body">
                            <div>
                                <md-select placeholder="API Method" [(ngModel)]="chatNode.ApiMethod" name="ApiMethod">
                                    <md-option *ngFor="let apiMethod of MH.apiMethods" [value]="apiMethod">
                                        {{ apiMethod || 'None' }}
                                    </md-option>
                                </md-select>
                                <md-form-field>
                                    <input mdInput type="url" placeholder="API Url" [(ngModel)]="chatNode.ApiUrl" name="ApiUrl">
                                </md-form-field>
                                <md-form-field class="contains-hint">
                                    <textarea rows="3" mdInput placeholder="Headers" [(ngModel)]="chatNode.Headers" name="Headers"></textarea>
                                    <md-hint>Enter one header per line. Separate Key and value with a colon. Eg: Content-Type:text/plain </md-hint>
                                </md-form-field>
                                <md-form-field>
                                    <input mdInput type="text" placeholder="Fallback Next Node Id" [(ngModel)]="chatNode.NextNodeId" name="NextNodeId">
                                </md-form-field>
                                <md-form-field [hidden]="!MH.chatNodeApiCallFieldVisible(chatNode, 'RequiredVariables')">
                                    <input mdInput type="text" placeholder="Required Variables" [(ngModel)]="chatNode.RequiredVariables" name="RequiredVariables">
                                </md-form-field>
                                <md-form-field [hidden]="!MH.chatNodeApiCallFieldVisible(chatNode, 'RequestBody')">
                                    <textarea rows="6" mdInput placeholder="Request Body" [(ngModel)]="chatNode.RequestBody" name="RequestBody"></textarea>
                                </md-form-field>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="node-card-details" [hidden]="chatNode.NodeType!='Card'">
                    <div class="panel panel-default">
                        <div class="panel-heading">Card Details</div>
                        <div class="panel-body">
                            <md-form-field>
                                <input mdInput type="text" placeholder="Card Header" [(ngModel)]="chatNode.CardHeader" name="CardHeader">
                            </md-form-field>
                            <md-form-field>
                                <input mdInput type="text" placeholder="Card Footer" [(ngModel)]="chatNode.CardFooter" name="CardFooter">
                            </md-form-field>
                            <md-select placeholder="Card Placement" [(ngModel)]="chatNode.Placement" name="Placement">
                                <md-option *ngFor="let cardPlacement of MH.cardPlacements" [value]="cardPlacement">
                                    {{ cardPlacement || 'None' }}
                                </md-option>
                            </md-select>
                        </div>
                    </div>
                </div>
            </div>
        </md-tab>
        <md-tab label="Content" *ngIf="['Card', 'Combination'].indexOf(chatNode.NodeType)!=-1">
            <div class="node-section-details tab-content">
                <div class="node-section" *ngFor="let section of chatNode.Sections; let i = index">
                    <div [ngSwitch]="MH.editorTypeFromSectionType(section.SectionType)">
                        <ng-container *ngSwitchCase="'Text'">
                            <div class="node-text-section">
                                <md-form-field>
                                    <span mdPrefix>
                                        <i class="fa fa-file-text-o text-section-icon"></i>
                                        &nbsp;
                                    </span>
                                    <input mdInput type="text" placeholder="Section text" [(ngModel)]="section.Text" name="sectionText-{{i}}">
                                    <span mdSuffix style="font-size: 24px">
                                        <button md-icon-button (click)="MH.sectionMoveUp(chatNode, section)">
                                            <md-icon>arrow_upward</md-icon>
                                        </button>
                                        <button md-icon-button (click)="MH.sectionMoveDown(chatNode, section)">
                                            <md-icon>arrow_downward</md-icon>
                                        </button>
                                        <button md-icon-button (click)="MH.sectionDelete(chatNode, section)">
                                            <md-icon>delete</md-icon>
                                        </button>
                                    </span>
                                </md-form-field>
                            </div>
                        </ng-container>
                        <ng-container *ngSwitchCase="'TitleCaptionUrl'">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <i [mdTooltip]="section.SectionType + ' Section'" class="fa panel-header-icon" [ngClass]="MH.sectionIcon(section)"></i> Section: {{MH.sectionAlias(section)}}
                                    <div class="pull-right panel-heading-actions">
                                        <button md-icon-button (click)="MH.sectionMoveUp(chatNode, section)">
                                            <md-icon>arrow_upward</md-icon>
                                        </button>
                                        <button md-icon-button (click)="MH.sectionMoveDown(chatNode, section)">
                                            <md-icon>arrow_downward</md-icon>
                                        </button>
                                        <button md-icon-button (click)="MH.sectionDelete(chatNode, section)">
                                            <md-icon>delete</md-icon>
                                        </button>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <md-form-field>
                                        <input mdInput type="text" placeholder="Title" [(ngModel)]="section.Title" name="sectionTitle-{{i}}">
                                    </md-form-field>
                                    <md-form-field>
                                        <input mdInput type="url" placeholder="Url" [(ngModel)]="section.Url" name="sectionUrl-{{i}}">
                                    </md-form-field>
                                    <md-form-field>
                                        <input mdInput type="text" placeholder="Caption" [(ngModel)]="section.Caption" name="sectionCaption-{{i}}">
                                    </md-form-field>
                                </div>
                            </div>
                        </ng-container>
                        <ng-container *ngSwitchCase="'Carousel'">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <i [mdTooltip]="section.SectionType + ' Section'" class="fa panel-header-icon" [ngClass]="MH.sectionIcon(section)"></i> Carousel
                                    <div class="pull-right panel-heading-actions">
                                        <button mdTooltip="Add Carousel Item" md-icon-button (click)="MH.carouselItemAdd(section)">
                                            <md-icon>add</md-icon>
                                        </button>
                                        <button md-icon-button (click)="MH.sectionMoveUp(chatNode, section)">
                                            <md-icon>arrow_upward</md-icon>
                                        </button>
                                        <button md-icon-button (click)="MH.sectionMoveDown(chatNode, section)">
                                            <md-icon>arrow_downward</md-icon>
                                        </button>
                                        <button md-icon-button (click)="MH.sectionDelete(chatNode, section)">
                                            <md-icon>delete</md-icon>
                                        </button>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <div class="carousel-container">
                                        <span *ngIf="!section.Items || section.Items.length<=0">Add a carousel item using the plus (+) button in this panel's header</span>
                                        <div class="carousel-item" *ngFor="let carItem of section.Items">
                                            <div class="panel panel-default">
                                                <div class="panel-heading">
                                                    <i mdTooltip="Carousel Item" class="fa panel-header-icon" [ngClass]="MH.sectionIcon(section)"></i> Carousel Item: {{carItem.Title}}
                                                    <div class="pull-right panel-heading-actions">
                                                        <button md-icon-button mdTooltip="Add Carousel Button" (click)="MH.carouselButtonAdd(carItem)">
                                                            <md-icon>add</md-icon>
                                                        </button>
                                                        <button md-icon-button (click)="MH.carouselItemMoveUp(section, carItem)">
                                                            <md-icon>arrow_upward</md-icon>
                                                        </button>
                                                        <button md-icon-button (click)="MH.carouselItemMoveDown(section, carItem)">
                                                            <md-icon>arrow_downward</md-icon>
                                                        </button>
                                                        <button md-icon-button (click)="MH.carouselItemDelete(section, carItem)">
                                                            <md-icon>delete</md-icon>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="panel-body">
                                                    <md-form-field>
                                                        <input mdInput type="text" placeholder="Title" [(ngModel)]="carItem.Title" name="carItemTitle-{{i}}">
                                                    </md-form-field>
                                                    <md-form-field>
                                                        <input mdInput type="url" placeholder="Image Url" [(ngModel)]="carItem.ImageUrl" name="carItemImageUrl-{{i}}">
                                                    </md-form-field>
                                                    <md-form-field>
                                                        <input mdInput type="text" placeholder="Caption" [(ngModel)]="carItem.Caption" name="carItemCaption-{{i}}">
                                                    </md-form-field>
                                                    <div class="carousel-buttons" *ngFor="let carBtn of carItem.Buttons">
                                                        <div class="panel panel-default">
                                                            <div class="panel-heading">
                                                                <i mdTooltip="Carousel Button" class="fa panel-header-icon" [ngClass]="MH.sectionIcon(section)"></i> Carousel Button: {{carBtn.Text}}
                                                                <div class="pull-right panel-heading-actions">
                                                                    <button md-icon-button (click)="MH.carouselButtonMoveUp(carItem, carBtn)">
                                                                        <md-icon>arrow_upward</md-icon>
                                                                    </button>
                                                                    <button md-icon-button (click)="MH.carouselButtonMoveDown(carItem, carBtn)">
                                                                        <md-icon>arrow_downward</md-icon>
                                                                    </button>
                                                                    <button md-icon-button (click)="MH.carouselButtonDelete(carItem, carBtn)">
                                                                        <md-icon>delete</md-icon>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            <div class="panel-body">
                                                                <md-form-field>
                                                                    <input mdInput type="text" placeholder="Text" [(ngModel)]="carBtn.Text" name="carBtnText-{{i}}">
                                                                </md-form-field>
                                                                <section class="form-field">
                                                                    <md-select placeholder="Type" [(ngModel)]="carBtn.Type" name="carBtnType">
                                                                        <md-option *ngFor="let bType of MH.carouselButtonTypes" [value]="bType">
                                                                            {{ bType || 'None' }}
                                                                        </md-option>
                                                                    </md-select>
                                                                </section>
                                                                <md-form-field *ngIf="carBtn.Type==MH.CarouselButtonType.OpenUrl || carBtn.Type==MH.CarouselButtonType.DeepLink">
                                                                    <input mdInput type="url" placeholder="Url" [(ngModel)]="carBtn.Url" name="carBtnUrl-{{i}}">
                                                                </md-form-field>
                                                                <md-form-field>
                                                                    <input mdInput type="text" placeholder="Next Node Id" [(ngModel)]="carBtn.NextNodeId" name="carBtnNextNodeId-{{i}}">
                                                                </md-form-field>
                                                                <md-form-field>
                                                                    <input mdInput type="text" placeholder="Variable Value" [(ngModel)]="carBtn.VariableValue" name="carBtnVariableValue-{{i}}">
                                                                </md-form-field>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </div>
                <section class="text-center">
                    <md-menu #addSectionMenu="mdMenu">
                        <button md-menu-item (click)="MH.addSection(chatNode, SectionType.Text)">Text</button>
                        <button md-menu-item (click)="MH.addSection(chatNode, SectionType.Image)">Image</button>
                        <button md-menu-item (click)="MH.addSection(chatNode, SectionType.Gif)">Gif</button>
                        <button md-menu-item (click)="MH.addSection(chatNode, SectionType.Audio)">Audio</button>
                        <button md-menu-item (click)="MH.addSection(chatNode, SectionType.Video)">Video</button>
                        <button md-menu-item (click)="MH.addSection(chatNode, SectionType.Carousel)">Carousel</button>
                    </md-menu>

                    <button type="button" mdTooltip="Add Section" [mdMenuTriggerFor]="addSectionMenu" md-fab>
                        <md-icon class="fab-btn-icon">add</md-icon>
                    </button>
                </section>
            </div>
        </md-tab>
        <md-tab label="Buttons">
            <div class="tab-content">
                <div class="node-buttons" *ngFor="let btn of chatNode.Buttons; let i = index">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Button: {{MH.chatButtonAlias(btn)}}
                            <div class="pull-right panel-heading-actions">
                                <button md-icon-button (click)="MH.buttonMoveUp(chatNode, btn)">
                                    <md-icon>arrow_upward</md-icon>
                                </button>
                                <button md-icon-button (click)="MH.buttonMoveDown(chatNode, btn)">
                                    <md-icon>arrow_downward</md-icon>
                                </button>
                                <button md-icon-button (click)="MH.buttonDelete(chatNode, btn)">
                                    <md-icon>delete</md-icon>
                                </button>
                            </div>
                        </div>
                        <div class="panel-body">
                            <section class="form-field" [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'ButtonType')">
                                <md-select placeholder="Type" [(ngModel)]="btn.ButtonType" name="btnType-{{i}}">
                                    <md-option *ngFor="let bType of MH.buttonTypes" [value]="bType">
                                        {{ bType }}
                                    </md-option>
                                </md-select>
                            </section>

                            <md-form-field>
                                <input mdInput type="text" [placeholder]="['ApiCall', 'Condition'].indexOf(chatNode.NodeType)==-1?'Text on button':'Button Name'" [(ngModel)]="btn.ButtonName" name="btnName-{{i}}">
                            </md-form-field>
                            <!--<md-form-field [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'ButtonText')">
        <input mdInput type="text" placeholder="Text in chat" [(ngModel)]="btn.ButtonText" name="btnText-{ {i}}">
    </md-form-field>-->
                            <md-form-field [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'ConditionMatchKey')">
                                <input mdInput type="text" placeholder="Condition Match Key" [(ngModel)]="btn.ConditionMatchKey" name="btnConditionMatchKey-{{i}}">
                            </md-form-field>
                            <section class="form-field" [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'ConditionOperator')">
                                <md-select placeholder="Condition Operator" [(ngModel)]="btn.ConditionOperator" name="btnConditionOperator-{{i}}">
                                    <md-option *ngFor="let CO of MH.conditionOperators" [value]="CO">
                                        {{ CO }}
                                    </md-option>
                                </md-select>
                            </section>
                            <md-form-field [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'ConditionMatchValue')">
                                <input mdInput type="text" placeholder="Condition Match Value" [(ngModel)]="btn.ConditionMatchValue" name="btnConditionMatchValue-{{i}}">
                            </md-form-field>
                            <md-form-field [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'PlaceholderText')">
                                <input mdInput type="text" placeholder="Placeholder" [(ngModel)]="btn.PlaceholderText" name="btnPlaceholderText-{{i}}">
                            </md-form-field>
                            <md-form-field [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'DeepLinkUrl')">
                                <input mdInput type="text" placeholder="Deeplink Url" [(ngModel)]="btn.DeepLinkUrl" name="btnDeepLinkUrl-{{i}}">
                            </md-form-field>
                            <md-form-field [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'Url')">
                                <input mdInput type="text" placeholder="Url" [(ngModel)]="btn.Url" name="btnUrl-{{i}}">
                            </md-form-field>
                            <md-form-field class="contains-hint" [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'ItemsSource')" hintLabel="Format: 'Key1:Value1, Key2:Value2'  Eg: 'Car:1, Bike:2'">
                                <textarea mdInput type="text" placeholder="Items" [(ngModel)]="btn.ItemsSource" name="btnItemsSource-{{i}}"></textarea>
                            </md-form-field>
                            <section class="form-field" [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'AllowMultiple')">
                                <md-checkbox [(ngModel)]="btn.AllowMultiple" name="btnAllowMultiple-{{i}}" align="start">Allow Multiple</md-checkbox>
                            </section>
                            <md-form-field [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'NextNodeId')">
                                <input mdInput type="text" placeholder="Next Node Id" [(ngModel)]="btn.NextNodeId" name="btnNextNodeId-{{i}}">
                            </md-form-field>
                            <section class="form-field">
                                <md-checkbox [(ngModel)]="btn.AdvancedOptions" name="btnAdvancedOptions-{{i}}" align="start">Advanced options</md-checkbox>
                            </section>
                            <div class="btn-advanced-options" [hidden]="!btn.AdvancedOptions">
                                <md-form-field>
                                    <input mdInput type="text" placeholder="Variable Value" [(ngModel)]="btn.VariableValue" name="btnVariableValue-{{i}}">
                                </md-form-field>

                                <!--<md-form-field [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'PrefixText')">
            <input mdInput type="text" placeholder="Prefix" [(ngModel)]="btn.PrefixText" name="btnPrefixText-{ {i}}">
        </md-form-field>
        <md-form-field [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'PostfixText')">
            <input mdInput type="text" placeholder="Postfix" [(ngModel)]="btn.PostfixText" name="btnPostfixText-{ {i}}">
        </md-form-field>-->
                                <md-form-field [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'MinLength')">
                                    <input mdInput type="number" placeholder="Minimum Length" [(ngModel)]="btn.MinLength" name="btnMinLength-{{i}}">
                                </md-form-field>
                                <md-form-field [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'MaxLength')">
                                    <input mdInput type="number" placeholder="Maximum Length" [(ngModel)]="btn.MaxLength" name="btnMaxLength-{{i}}">
                                </md-form-field>
                                <md-form-field [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'DefaultText')">
                                    <input mdInput type="text" placeholder="Default Text" [(ngModel)]="btn.DefaultText" name="btnDefaultText-{{i}}">
                                </md-form-field>
                                <section class="form-field" [hidden]="MH.chatButtonFieldHidden(chatNode, btn, 'IsMultiLine')">
                                    <md-checkbox [(ngModel)]="btn.IsMultiLine" name="btnIsMultiLine-{{i}}" align="start">Multiple line allowed</md-checkbox>
                                </section>
                                <!--<section class="form-field">
            <md-checkbox [(ngModel)]="btn.PostToChat" name="btnPostToChat-{ {i}}" align="start">Post to chat</md-checkbox>
        </section>-->
                            </div>
                            <!--<section class="form-field">
        <md-checkbox [(ngModel)]="btn.DoesRepeat" name="btnDoesRepeat-{ {i}}" align="start">Does repeat</md-checkbox>
    </section>
    <div class="btn-repeat-options" [hidden]="!btn.DoesRepeat">
        <md-form-field>
            <input mdInput type="text" placeholder="Repeat On" [(ngModel)]="btn.RepeatOn" name="btnRepeatOn-{ {i}}">
        </md-form-field>
        <md-form-field>
            <input mdInput type="text" placeholder="Repeat As" [(ngModel)]="btn.RepeatAs" name="btnRepeatAs-{ {i}}">
        </md-form-field>
        <md-form-field>
            <input mdInput type="number" placeholder="Start Position" [(ngModel)]="btn.StartPosition" name="btnStartPosition-{ {i}}">
        </md-form-field>
        <md-form-field>
            <input mdInput type="number" placeholder="Max Repeats" [(ngModel)]="btn.MaxRepeats" name="btnMaxRepeats-{ {i}}">
        </md-form-field>
    </div>-->
                        </div>
                    </div>
                </div>
                <section class="text-center">
                    <button mdTooltip="Add Button" type="button" md-fab (click)="MH.addButton(chatNode)">
                        <md-icon class="fab-btn-icon">add</md-icon>
                    </button>
                </section>
            </div>
        </md-tab>
    </md-tab-group>
</md-dialog-content>
<md-dialog-actions>
    <button type="button" (click)="dismiss()" md-raised-button color="primary">
        Done
    </button>
    <span class="spacing"></span>
    <button type="button" mdTooltip="Delete Node" (click)="MH.nodeDelete(chatNode, this)" md-raised-button>
        Delete Node
    </button>
</md-dialog-actions>